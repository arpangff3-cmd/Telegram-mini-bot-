<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EARN MONEY FF</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script><script type="text/javascript">
	atOptions = {
		'key' : 'f9a8aa059891f11e7ebb65bdd2932d3d',
		'format' : 'iframe',
		'height' : 300,
		'width' : 160,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/f9a8aa059891f11e7ebb65bdd2932d3d/invoke.js"></script>
    
    <style>
        /* Global Styles & Dark Theme */
        :root {
            --bg-color: #1a1a2e;
            --card-color: #2c2c54;
            --primary-color: #00bcd4; /* Cyan/Teal */
            --text-color: #f0f0f0;
            --accent-color: #ff6b6b; /* Reddish */
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            padding: 20px 15px;
            flex-grow: 1;
        }

        /* Utility Styles */
        .card {
            background-color: var(--card-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
        }

        button {
            background-color: var(--primary-color);
            color: var(--bg-color);
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0097a7;
        }

        input[type="text"], input[type="number"] {
            width: calc(100% - 24px);
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #444;
            border-radius: 8px;
            background-color: #3e3e68;
            color: var(--text-color);
            box-sizing: border-box;
        }

        /* Navigation (Tabs) */
        .navbar {
            display: flex;
            justify-content: space-around;
            background-color: var(--card-color);
            padding: 10px 0;
            position: sticky;
            bottom: 0;
            width: 100%;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
        }

        .nav-item {
            color: var(--text-color);
            text-decoration: none;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            flex-grow: 1;
            transition: color 0.3s, background-color 0.3s;
        }

        .nav-item.active {
            color: var(--primary-color);
            background-color: #4c4c7c;
        }

        /* Section Display */
        .screen {
            display: none; /* All screens hidden by default */
        }

        .screen.active {
            display: block;
        }

        /* Tap & Earn Section Specifics */
        #tap-area {
            text-align: center;
            padding: 40px 20px;
            cursor: pointer;
        }

        #usdt-image {
            width: 80px;
            height: 80px;
            animation: bounce 1.5s infinite ease-in-out alternate;
        }

        @keyframes bounce {
            0% { transform: scale(1) translateY(0); }
            100% { transform: scale(1.1) translateY(-10px); }
        }

        .coin-credit-animation {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            color: gold;
            opacity: 0;
            pointer-events: none;
            animation: flyup 1s ease-out forwards;
        }

        @keyframes flyup {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        /* Task Section Specifics */
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border-bottom: 1px solid #3e3e68;
        }

        /* Admin Panel Styles (Conceptual) */
        #admin-panel {
            background-color: var(--accent-color);
            color: white;
            padding: 15px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="admin-header" style="display:none;">
        <div id="admin-panel">
            <h2>‚öôÔ∏è Admin Mode ‚öôÔ∏è</h2>
            <p>This is only visible in a regular web browser for demonstration. In a real app, this MUST be secured with Firebase Auth.</p>
        </div>
        </div>

    <div class="container" id="main-app-container">

        <div id="loading-screen" class="screen active" style="text-align: center; padding-top: 100px;">
            <h2>Loading EARN MONEY FF...</h2>
            <p>Initializing Firebase and fetching user data. Please wait. üöÄ</p>
        </div>

        <div id="tap-earn-screen" class="screen">
            <h2 style="text-align: center;">Tap & Earn üí∞</h2>
            <div class="card" style="text-align: center;">
                <h3>Current Coins: <span id="coin-display">0</span></h3>
                <h3>Level: <span id="level-display">1</span></h3>
            </div>
            <div class="card" id="tap-area">
                <img id="usdt-image" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Tether_USDT_logo.svg/1200px-Tether_USDT_logo.svg.png" alt="USDT Coin">
                <p>Tap the USDT coin to earn!</p>
            </div>
        </div>

        <div id="tasks-screen" class="screen">
            <h2>Daily Tasks üéØ</h2>
            <div class="card">
                <h3>Refer and Earn</h3>
                <p>Invite friends and earn 500 coins per referral!</p>
                <input type="text" id="referral-link" readonly value="Generating unique link..." onclick="this.select(); navigator.clipboard.writeText(this.value);">
                <button onclick="copyReferralLink()">Copy Link üîó</button>
            </div>

            <div class="card">
                <h3>General Tasks</h3>
                <div id="tasks-list">
                    <div class="task-item">
                        <span>Watch Ad (Monotag Mock)</span>
                        <button onclick="watchAd()">Watch & Earn üì∫ (+100)</button>
                    </div>
                    <div class="task-item">
                        <span>Join Telegram Channel </span>
                        <a href="https://t.me/telegram_channel_mock" target="_blank" style="margin-right: 10px;"><button>Join Channel</button></a>
                        <button onclick="verifyJoin('channel1')">Verify ‚úÖ (+200)</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="withdrawal-screen" class="screen">
            <h2>Withdraw Coins üí∏</h2>
            <div class="card">
                <p>Exchange Rate: 10,000 Coins = 1 USDT</p>
                <p>Your Current Coins: <strong id="withdraw-coin-count">0</strong><script type="text/javascript">
	atOptions = {
		'key' : 'f9a8aa059891f11e7ebb65bdd2932d3d',
		'format' : 'iframe',
		'height' : 300,
		'width' : 160,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/f9a8aa059891f11e7ebb65bdd2932d3d/invoke.js"></script></p>
                <label for="withdraw-amount">Coins to Withdraw:</label>
                <input type="number" id="withdraw-amount" placeholder="e.g., 10000" min="10000">
                <label for="usdt-address">USDT (TRC-20) Wallet Address:</label>
                <input type="text" id="usdt-address" placeholder="Enter your USDT wallet address">
                <button onclick="submitWithdrawal()">Submit Request</button>
            </div>

            <div class="card">
                <h3>Withdrawal History</h3>
                <div id="withdrawal-history">
                    <p style="text-align: center;">No requests yet.</p>
                </div>
            </div>
        </div>

        <div id="profile-screen" class="screen">
            <h2>Your Profile üë§</h2>
            <div class="card" style="text-align: center;">
                <img id="profile-photo" src="https://via.placeholder.com/100" alt="Profile Photo" style="border-radius: 50%; width: 100px; height: 100px; object-fit: cover; margin-bottom: 10px;">
                <h3>Telegram ID: <span id="telegram-id-display">N/A</span></h3>
                <p>Username: <span id="telegram-username-display">N/A</span></p>
                <hr style="border-color: #3e3e68;">
                <p>Current Coins: <strong><span id="profile-coin-display">0</span></strong> üí∞</p>
                <p>Current Level: <strong><span id="profile-level-display">1</span></strong> ‚≠ê</p>
                <p>User ID (Firebase): <span id="uid-display">Loading...</span></p>
            </div>
            <div class="card">
                <h3>Settings</h3>
                <button onclick="logoutUser()" style="background-color: var(--accent-color);">Logout (Firebase)</button>
            </div>
        </div>
    </div>
    
    <div class="navbar">
        <a href="#" class="nav-item active" data-screen="tap-earn-screen">Tap & Earn ‚ú®</a>
        <a href="#" class="nav-item" data-screen="tasks-screen">Tasks üéØ</a>
        <a href="#" class="nav-item" data-screen="withdrawal-screen">Withdraw üí∏</a>
        <a href="#" class="nav-item" data-screen="profile-screen">Profile üë§</a>
    </div>

    <script>
        // 1. FIREBASE CONFIGURATION (MOCK)
        // **IMPORTANT**: REPLACE WITH YOUR ACTUAL FIREBASE CONFIG
        const firebaseConfig = {
  apiKey: "AIzaSyCe45vNKWH6Zo5tQJ4gUNyttwwmvSKRgQk",
  authDomain: "telegram-bot-bb9d0.firebaseapp.com",
  projectId: "telegram-bot-bb9d0",
  storageBucket: "telegram-bot-bb9d0.firebasestorage.app",
  messagingSenderId: "622589412377",
  appId: "1:622589412377:web:0cc810fff02f582dc19688",
  measurementId: "G-YJ82J90B8D"
};

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = app.auth();
        const db = app.firestore();
        let userRef; // Reference to the user's document in Firestore
        let userCoins = 0;
        let userLevel = 1;
        let userId = null;

        // 2. INITIALIZATION AND AUTHENTICATION
        
        // Check if the current environment is a standard web browser (for Admin Mode)
        const isTelegramWebApp = window.Telegram && window.Telegram.WebApp;
        if (!isTelegramWebApp) {
            // Admin mode is conceptually enabled here for regular web browser access.
            // THIS IS INSECURE. A real app MUST use Firebase Auth for admin access.
            document.getElementById('admin-header').style.display = 'block';
            document.getElementById('main-app-container').style.display = 'none';
        }

        // Firebase Anonymous Login (Simplified for quick demo)
        auth.onAuthStateChanged(user => {
            if (user) {
                userId = user.uid;
                userRef = db.collection('users').doc(userId);
                
                // Fetch user data from Firebase or LocalStorage
                loadUserData();

                // Check for Telegram WebApp data and update profile
                if (isTelegramWebApp) {
                    initTelegramWebApp();
                } else {
                    document.getElementById('telegram-id-display').textContent = 'Web Browser Mock';
                    document.getElementById('telegram-username-display').textContent = 'Web Browser Mock';
                }

                // Hide loading screen and show the first tab
                document.getElementById('loading-screen').classList.remove('active');
                document.getElementById('tap-earn-screen').classList.add('active');
                
                // Start listening for real-time coin updates
                setupCoinListener();
                setupWithdrawalListener();
            } else {
                // If not logged in, log in anonymously
                auth.signInAnonymously().catch(error => {
                    console.error("Anonymous sign-in failed:", error);
                    alert("Authentication failed. Please try again.");
                });
            }
        });

        // 3. DATA MANAGEMENT: LOCALSTORAGE & FIREBASE SYNC

        // Load data from LocalStorage first, then fall back to Firebase
        function loadUserData() {
            try {
                const localData = JSON.parse(localStorage.getItem('userData_' + userId));
                if (localData) {
                    userCoins = localData.coins || 0;
                    userLevel = localData.level || 1;
                    console.log("Data loaded from LocalStorage.");
                } else {
                    console.log("No LocalStorage data found, fetching from Firebase...");
                    fetchUserDataFromFirebase();
                }
                updateUIDisplays();
            } catch (e) {
                console.warn("Error reading LocalStorage, fetching from Firebase.", e);
                fetchUserDataFromFirebase();
            }
        }

        // Fetch user data from Firebase and initialize if new user
        function fetchUserDataFromFirebase() {
            userRef.get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    userCoins = data.coins || 0;
                    userLevel = data.level || 1;
                } else {
                    // New user initialization
                    userCoins = 0;
                    userLevel = 1;
                    userRef.set({
                        uid: userId,
                        telegramId: document.getElementById('telegram-id-display').textContent,
                        username: document.getElementById('telegram-username-display').textContent,
                        coins: userCoins,
                        level: userLevel,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                saveDataToLocalStorage();
                updateUIDisplays();
            }).catch(e => {
                console.error("Error fetching user data from Firebase:", e);
                alert("Could not load user data. Check console.");
            });
        }

        // Listen for real-time updates from Firebase
        function setupCoinListener() {
            userRef.onSnapshot(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    userCoins = data.coins || 0;
                    userLevel = data.level || 1;
                    saveDataToLocalStorage();
                    updateUIDisplays();
                }
            }, error => {
                console.error("Coin real-time listener failed:", error);
            });
        }

        // Save current state to LocalStorage
        function saveDataToLocalStorage() {
            const data = {
                coins: userCoins,
                level: userLevel
            };
            localStorage.setItem('userData_' + userId, JSON.stringify(data));
        }

        // Update all UI elements showing coins and level
        function updateUIDisplays() {
            document.getElementById('coin-display').textContent = userCoins;
            document.getElementById('profile-coin-display').textContent = userCoins;
            document.getElementById('withdraw-coin-count').textContent = userCoins;
            document.getElementById('level-display').textContent = userLevel;
            document.getElementById('profile-level-display').textContent = userLevel;
            document.getElementById('uid-display').textContent = userId || 'N/A';
        }

        // Update Firebase and check for level up
        function updateCoins(amount) {
            userCoins += amount;
            
            // Level Up Logic: Level increases every 1000 coins
            const newLevel = Math.floor(userCoins / 1000) + 1;
            if (newLevel > userLevel) {
                userLevel = newLevel;
                alert(`üéâ Level Up! You are now Level ${userLevel}!`);
            }

            // Sync to Firebase and LocalStorage
            userRef.update({
                coins: userCoins,
                level: userLevel
            }).then(() => {
                console.log("Coins and Level updated in Firebase.");
                saveDataToLocalStorage(); // Update local storage after successful Firebase sync
                updateUIDisplays();
            }).catch(e => {
                console.error("Failed to update Firebase:", e);
                // Revert client-side coins if Firebase fails (basic error handling)
                userCoins -= amount; 
                alert("Error updating coins. Please check your connection.");
            });
        }

        // 4. TELEGRAM WEBAPP INTEGRATION (MOCK)

        function initTelegramWebApp() {
            if (isTelegramWebApp) {
                const tg = window.Telegram.WebApp;
                const user = tg.initDataUnsafe.user;
                
                if (user) {
                    document.getElementById('telegram-id-display').textContent = user.id || 'N/A';
                    document.getElementById('telegram-username-display').textContent = user.username || 'N/A';
                    
                    // Note: Profile photo is not directly available via initData, so this is a placeholder/mock
                    // You'd need a bot API call for the real photo.
                }

                // Update Telegram-specific data in Firestore
                if (userRef) {
                    userRef.update({
                        telegramId: user.id || 'N/A',
                        username: user.username || 'N/A',
                        firstName: user.first_name || '',
                        lastName: user.last_name || ''
                    }).catch(e => console.error("Failed to update TG data:", e));
                }
            }
        }

        // 5. TAP & EARN LOGIC

        document.getElementById('tap-area').addEventListener('click', function(e) {
            // Credit 1 coin per tap
            const creditAmount = 1;
            updateCoins(creditAmount);

            // Coin credit animation (Visual feedback)
            const coinAnim = document.createElement('div');
            coinAnim.textContent = `+${creditAmount}`;
            coinAnim.classList.add('coin-credit-animation');
            
            // Get position relative to the viewport
            const rect = document.getElementById('tap-area').getBoundingClientRect();
            
            // Set position where the tap occurred
            coinAnim.style.left = e.clientX - rect.left + 'px';
            coinAnim.style.top = e.clientY - rect.top + 'px';
            
            this.appendChild(coinAnim);

            // Remove the element after the animation finishes
            coinAnim.addEventListener('animationend', () => {
                coinAnim.remove();
            });
        });

        // 6. TASKS LOGIC

        function copyReferralLink() {
            // A truly unique and secure link requires a backend (e.g., Firebase Cloud Function)
            // This is a client-side mock based on the user's UID
            const referralLink = `https://your-app-domain.com/?ref=${userId}`;
            document.getElementById('referral-link').value = referralLink;
            
            // Standard clipboard copy
            navigator.clipboard.writeText(referralLink).then(() => {
                alert("Referral link copied! Share it now!");
            }).catch(err => {
                console.error('Could not copy text: ', err);
                alert("Failed to copy link. Please manually copy the text.");
            });
        }

        